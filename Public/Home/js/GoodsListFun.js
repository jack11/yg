var CBLFun=null;$(document).ready(function(){var c="http://www.1yyg.com";var a="http://skin.1yyg.com";var b=function(){var q=parseInt($("#hidSortID").val());var u=parseInt($("#hidBrandID").val());var e=parseInt($("#hidPageIndex").val());var F=parseInt($("#hidOrder").val());var E=parseInt($("#hidLimitTag").val())==10;var t=0;var g=20;var m=40;var n=m/g;var o=1;var r=0;var f=0;var s=$("#divTopPageInfo");var D=$("#ulGoodsList");var y=$("#divPageNav");var l=$("#divLoadingLine");var v=true;var x=false;var w=false;var p=new Object();var j=$("#ulBrandList");var B=j.height();var i=j.children("li").length;var A=28;var C=false;var z=function(){var H=A;var G=$(window).width()<1190?7:8;if(i%G==0){H=(i/G)*A}else{H=parseInt(i/G+1)*A}return H};$("#btnExpend").click(function(G){G.preventDefault();if(C){j.height(B+"px");$(this).removeClass("hover").html('展开<div class="f-top-arrow"><cite>◆</cite><b>◆</b></div>')}else{j.height(z()+"px");$(this).addClass("hover").html('收起<div class="f-top-arrow"><cite>◆</cite><b>◆</b></div>')}C=!C});$(window).resize(function(){if(C){j.height(z()+"px")}D.find("div.u_buyCount").each(function(){$(this).html("").hide()})});$("li[name='liPrice']").each(function(H,G){if(H==0){$(this).hover(function(){$(this).hide().next().show()},function(){})}else{$(this).hover(function(){},function(){$(this).hide().prev().show()})}});var d=function(){var G=(e-1)*m;return"sortID="+q+"&brandID="+u+"&orderFlag="+F+"&FIdx="+(G+1)+"&EIdx="+(G+m)+"&isCount="+o};var h=function(){o=1;return"FIdx=1&EIdx=20&IsCount=1"};var k=function(){var I=function(){l.show();var K=E?"getLimitGoodsPage":"getGoodsList";var J=E?h():d();GetJPData("http://api.1yyg.com",K,J,function(N){var L=E?N.code:N.Code;if(L==0){var M=function(){if(o==1){r=E?N.totalCount:N.Count;f=r%m==0?r/m:parseInt(r/m)+1;o=0}var P='<p class="Fl">共<em class="orange">'+r+"</em>件商品<b>"+e+"</b>/"+f+'</p><div class="u-list-btn fl"><a href="'+(e==1?"javascript:;":H(e-1))+'" class="'+(e==1?"u-btn-gray":"")+'" title="上一页"><span class="f-tran f-tran-prev">&lt;</span>上一页</a><a href="'+(e==f?"javascript:;":H(e+1))+'" class="'+(f>1?(e==f?"u-btn-gray":""):"u-btn-gray")+'" title="下一页">下一页<span class="f-tran f-tran-next">&gt;</span></a></div>';s.html(P);l.hide();var O=E?N.listItems:N.Data.Tables.Table1.Rows;var Q=O.length;if(Q>0){p["page"+e]=O;G()}else{t=n}};if(x){M()}else{Base.getScript("http://skin.1yyg.com/JS/GoodsComm.js?date=150416",function(){x=true;M()})}}else{l.hide();if(t==0){D.hide().after('<div class="g-noConMsg"><span>未找到有关商品</span></div>')}else{if(e!=1&&r>m){y.html(getListPaging(r,m,e,5,H)).show()}}t=n}v=false})};var G=function(){t++;var N=p["page"+e];if(N!=null&&N!=undefined){var T=N.length;var J=(t-1)*g;var V=J+g;V=V>T?T:V;var S="";var Q="";var K=0;var O=0;var L=0;var U=0;var aa=0;D.show();var X=$(window).width()<1190?217:266;for(var Z=J;Z<V;Z++){S="";var M="";var W=E?10:parseInt(N[Z].goodsTag);switch(W){case 1:M+='<div class="f-callout"><span class="F_goods_xp transparent-png">新品</span></div>';break;case 2:M+='<div class="f-callout"><span class="F_goods_tj transparent-png">推荐</span></div>';break;case 3:M+='<div class="f-callout"><span class="F_goods_rq transparent-png">人气</span></div>';break;case 10:M+='<div class="f-callout"><span class="F_goods_xg transparent-png">限购</span></div>';break}Q="(第"+N[Z].codePeriod+"期)&nbsp;"+N[Z].goodsSName;K=parseInt(N[Z].codeSales);O=parseInt(N[Z].codeQuantity);L=parseInt(O-K);U=parseFloat(K)/O;aa=parseInt(U*X);S+="<div idx="+(Z+1)+' class="soon-list-con '+((Z+1)%4==0?"soon-list4":"")+'" codeID="'+N[Z].codeID+'"><div class="soon-list"><ul><li class="g-soon-pic"><a href="/products/'+N[Z].goodsID+'.html" target="_blank" title="'+Q+'"><img name="goodsImg" src="http://goodsimg.1yyg.com/GoodsPic/pic-200-200/'+N[Z].goodsPic+'" /></a></li><li class="soon-list-name"><a href="/products/'+N[Z].goodsID+'.html" target="_blank" title="'+Q+'">'+Q+'</a></li><li class="gray6">价值：￥'+formatFloat(N[Z].codePrice)+'</li><li class="g-progress"><dl class="m-progress"><dt title="已完成'+formatFloat(U*100)+'%"><b style="width:'+(K==0?0:(parseInt(aa)==0?1:aa))+'px;"></b></dt><dd><span class="orange fl"><em>'+K+'</em>已参与</span><span class="gray6 fl"><em>'+O+'</em>总需人次</span><span class="blue fr"><em>'+L+'</em>剩余</span></dd></dl></li><li name="buyBox" limitBuy="'+N[Z].codeLimitBuy+'"><a href="javascript:;" title="立即1元云购" class="u-now">立即1元云购</a><a href="javascript:;" class="u-cart"><s></s></a></li></ul>'+M+"</div></div>";var R=$(S);if((Z+1)==V&&V%4!=0){R.addClass("f-add-borR")}D.append(R);R.GoodsItemFun()}if(T<g||t*g==r){t=n}if(t>=n){if(r>m){y.html(getListPaging(r,m,e,5,H)).parent().show();if(!w){w=true;var ab=$("#btnGotoPage");var P=ab.parent().prev().find("input");var ac=function(){var ad=parseInt(P.val());if(ad>0){if(ad>f){ad=f}window.location.href=H(ad)}return false};var Y=1;P.keyup(function(ae){var af=ae||window.event||arguments.callee.caller.arguments[0];if(af){if(af.keyCode==13){ac()}else{var ad=$(this).val();if(!(/^\d+$/.test(ad))){if(ad==""){$(this).val("")}else{$(this).val(Y)}}else{Y=ad;$(this).val(ad)}}}}).mouseover(function(){$(this).focus().select()}).blur(function(){if(!(/^\d+$/.test($(this).val()))){Y=1;$(this).val(Y)}});ab.click(function(){ac();return false})}}else{y.hide()}}D.show()}l.hide()};var H=function(J){var K="/list/";if(q>0){K+="i"+q}if(u>0){K+="b"+u}K+="m"+J;K+=".html";if(F>10){K+="?r="+F}return K};this.nextList=function(){G()};this.initPage=function(){I()}};$(window).scroll(function(){if(t<n&&!v){var G=$(window).scrollTop()+$(window).height();var H=D.offset().top+D.height();if(G>=H){if(v){return}if(D.children().length==0){return}v=true;CBLFun.nextList()}}});CBLFun=new k();CBLFun.initPage()};b()});