var _Ptn=/^\d+$/;var PagePOPLoginOK=null;var _IsLoadLoginJS=false;var _UserBalance=0;var _IsLimitBuy=false;var _LimitBuyNum=0;var _BuyedNum=0;var _GotoPayPage=false;var _IsLogined=true;var _IsLoadPlJs=false;$.fn.GoodsItemFun=function(){var c=$(this);var a=c.attr("codeID");c.hover(function(){var e=$(this);var d=parseInt(e.attr("limitBuy"))>0;if(d){e.addClass("products-hover")}else{if(parseInt(e.attr("idx"))%4==0){e.removeClass("soon-list4").addClass("soon-list-hover2")}e.addClass("soon-list-hover")}},function(){var d=parseInt($(this).attr("limitBuy"))>0;if(d){$(this).removeClass("products-hover")}else{if(parseInt($(this).attr("idx"))%4==0){$(this).addClass("soon-list4").removeClass("soon-list-hover2")}$(this).removeClass("soon-list-hover").children("div.u_buyCount").hide()}});var b=c.find("img[name='goodsImg']");c.find("li[name='buyBox']").GoodsBuyFun(b,a)};var GetJPDataEx=function(c,a,b){$.getJSON("http://account.1yyg.com/JPData/API.ashx?action="+c+"&"+a+"&fun=?",b)};var stopBubble=function(a){if(a&&a.stopPropagation){a.stopPropagation()}else{window.event.cancelBubble=true}};var addEvent=function(c,a,b,e){var d=function(){b.apply(e,arguments)};window.addEventListener?c.addEventListener(a,d,false):c.attachEvent("on"+a,d)},removeEvent=function(c,a,b){window.removeEventListener?c.removeEventListener(a,b,false):c.attachEvent("on"+a,b)};var getDefTip=function(){return _IsLimitBuy?("限购"+_LimitBuyNum+"人次")+(_BuyedNum>0?"，您已参与"+_BuyedNum+"人次":""):"请选择云购人次"};$.fn.GoodsCountFun=function(b){var n=$(this).children("input");var c=parseInt(n.attr("surplus"));var o=n.prev();var l=n.next();var u=$("#btnConfirmBuy");var s=$("#pageDialogMain");var e=$("#pageDialogClose");var k=n.parent().next();var t=function(y){if(y==""){k.attr("class","u-popup-Tip grayb").show().html(getDefTip())}else{k.attr("class","u-popup-Tip orange").show().html(y)}};var v="<s></s>已超过100人次，谨慎参与哦",h="<s></s>最少需云购1人次";var m=function(y){return _BuyedNum==0?"<s></s>最多可云购"+y+"人次":"<s></s>您已参与"+_BuyedNum+"人次，本期最多可云购"+y+"人次"};var x=k.next("div.u-popup-paytip");var f=function(z,y){_GotoPayPage=true;x.show().find("span.orange").html(z+".00");u.html("使用其它方式支付");s.css("height",y+"px")};var d=1;var r=function(y){d=y;n.val(y);if(_UserBalance>0){if(y>_UserBalance){f(y,300)}else{_GotoPayPage=false;x.hide();s.css("height","240px");u.html('确认支付<span class="mlr5">'+y+".00</span>元")}}else{f(y,300)}i()};var i=function(){if(d==1){o.addClass("num_ban");l.removeClass("num_ban")}else{if(d==c){o.removeClass("num_ban");l.addClass("num_ban")}else{o.removeClass("num_ban");if(_IsLimitBuy&&d==(_LimitBuyNum-_BuyedNum)){l.addClass("num_ban")}else{l.removeClass("num_ban")}}}};n.keyup(function(z){var y=n.val();if(y==""){t(h);r(1)}else{if(!_Ptn.test(y)){t("");r(d)}else{if(y==0){t(h);r(1)}else{if(y<=c){if(_IsLimitBuy){if(y>_LimitBuyNum-_BuyedNum){y=_LimitBuyNum-_BuyedNum;t(m(y))}else{if(y>100){t(v)}else{t("")}}}else{if(y>100){t(v)}else{t("")}}r(y)}else{y=c;if(_IsLimitBuy){if(y>_LimitBuyNum-_BuyedNum){y=_LimitBuyNum-_BuyedNum;t(m(y))}else{if(y>100){t(v)}else{t("<s></s>最多可云购"+y+"人次")}}}else{t("<s></s>最多可云购"+y+"人次")}r(y)}}}}}).keydown(function(y){if(13==((window.event)?event.keyCode:y.keyCode)){j()}}).val("1").select().focus().mouseover(function(){$(this).attr("mouseIn","1").focus().select();scrollFunc=function(A){A=A||window.event;if(A&&A.preventDefault){A.preventDefault()}else{window.event.returnValue=false}stopBubble(A);var B=0;if(A.wheelDelta){B=A.wheelDelta>0?1:-1}else{if(A.detail){B=A.detail<0?1:-1}}if(B&&n.attr("mouseIn")=="1"){var z=parseInt(n.val());if(B>0){if(z>0){if(z>=c){z=c;t("<s></s>最多可云购"+z+"人次")}else{t("");z=z+1;if(_IsLimitBuy){if(z>_LimitBuyNum-_BuyedNum){z=_LimitBuyNum-_BuyedNum;t(m(z))}else{if(z>100){t(v)}else{t("")}}}else{if(z>100){t(v)}else{t("")}}}}else{z=1}}else{if(z>1){z=z-1;if(z>100){t(v)}else{t("")}}else{z=1;t(h)}}n.val(z)}};var y=$(this).get(0);addEvent(y,"mousewheel",scrollFunc,y);addEvent(y,"DOMMouseScroll",scrollFunc,y)}).mouseout(function(){$(this).attr("mouseIn","0");var z=n.val();if(z>c){z=c}r(z);var y=$(this).get(0);removeEvent(y,"mousewheel",scrollFunc);removeEvent(y,"DOMMouseScroll",scrollFunc)});o.click(function(){var y=n.val();if(_Ptn.test(y)){var z=parseInt(y);if(z>1){t("");z--;if(z>100){t(v)}else{t("")}r(z)}else{}}return false});l.click(function(){var y=n.val();if(_Ptn.test(y)){var z=parseInt(y);if(z<c){t("");z++;if(_IsLimitBuy){if(z>_LimitBuyNum-_BuyedNum){z=_LimitBuyNum-_BuyedNum;t(m(z))}else{if(z>100){t(v)}else{t("")}}}else{if(z>100){t(v)}else{t("")}}r(z)}else{t("<s></s>最多可云购"+c+"人次")}}return false});$("body").keydown(function(y){if($("#divSuccMain").length>0&&13==((window.event)?event.keyCode:y.keyCode)){$.PageDialog.close()}});var g=function(){var y='<div class="content"><div id="divSuccMain" class="g-popup"><div class="g-pay-tip"><s class="f-pay-succeed"></s><p class="f-pay-tit gray6">支付成功！</p><p class="gray9">请进入＂<a href="http://member.1yyg.com/UserBuyList.do" target="_blank" class="gray6">我的云购记录</a>＂查看云购码</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">继续云购</a></p></div></div></div>';s.html(y);$("#btnClose").unbind("click").click(function(z){if(z&&z.stopPropagation){z.stopPropagation()}else{window.event.cancelBubble=true}$.PageDialog.close()})};var q=function(){var y='<div class="content"><div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail"></s><p class="f-pay-tit gray6">云购失败！</p><p class="gray9">被抢光了，您下手太慢了！</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">确 认</a></p></div></div></div>';s.html(y);$("#btnClose").unbind("click").click(function(){$.PageDialog.close();location.reload()})};var w=function(){var y='<div class="content"><div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail"></s><p class="f-pay-tit gray6">云购失败！</p><p class="gray9">很抱歉，购买失败了！</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">确 认</a></p></div></div></div>';s.html(y);$("#btnClose").unbind("click").click(function(){$.PageDialog.close();location.reload()})};var a=function(){var y='<div class="content"><div class="g-popup"><div class="g-pay-tip"><s class="f-pay-fail"></s><p class="f-pay-tit gray6">提交失败！</p><p class="gray9">提交失败，请重试！</p><p class="f-pay-btn"><a id="btnClose" href="javascript:;" class="orange_btn">确 认</a></p></div></div></div>';s.html(y);$("#btnClose").unbind("click").click(function(){$.PageDialog.close()})};var p=$("#buyBox");var j=function(){if(parseInt(d)>0){GetJPData("http://cart.1yyg.com","shopCartFast","codeID="+b+"&num="+d,function(y){if(y.code==0){if(_GotoPayPage){location.href="http://cart.1yyg.com/payment.do"}else{if(_IsBuySubmiting){return}_IsBuySubmiting=true;s.css("height","225px");p.attr("class","g-submit").html('<p class="f-submit-tit gray6">正在提交，请稍候...</p><div class="u-progress u-progress-c3"><span class="pgbar" style="width:100%"><span class="pging"></span></span></div>');e.hide();GetJPDataEx("UserPay","device=0&integral=0",function(z){var B=z.state;if(B==0){var A=function(){GetJPDataEx("getshopresult","t=2&id="+z.str,function(O){if(O.state==0){var F=O.code;if(F==1){_IsCartChanged=true;g();var H=$("#ulGoodsList").find('div[codeid="'+b+'"]');var K=H.find("li.g-progress");var E=K.find("span.orange").children("em");var I=parseInt(E.html())+parseInt(d);E.html(I);E=K.find("span.gray6").children("em");var L=parseInt(E.html());E=K.find("span.blue").children("em");var J=parseInt(E.html())-parseInt(d);E.html(J);var N=parseFloat(I)/L;var M=$(window).width()<1190?217:266;var G=parseInt(N*M);E=K.find("dl.m-progress").children("dt");E.attr("title","已完成"+formatFloat(N*100)+"%").html('<b style="width:'+(parseInt(G)==0?1:G)+'px;"></b>');E=H.children("div.u_buyCount");if(E.length>0){E.find("em").html(parseInt(E.find("em").html())+parseInt(d))}else{var D=1;if(parseInt(H.attr("idx"))%4==0){D=0}var C=H.width()-D;E.width(C+"px").html("<p></p><h3>本期您已参与<em>"+d+"</em>人次</h3>")}}else{if(F==2){q()}else{w()}}e.show()}else{setTimeout(A,500)}_IsBuySubmiting=false})};setTimeout(A,3000)}else{if(B==10){location.reload()}else{a()}e.show();_IsBuySubmiting=false}})}}else{if(y.code==10){location.reload()}else{a()}}})}else{n.focus().select()}};u.click(function(){j();return false}).hover(function(){if(!_GotoPayPage){}},function(){})};var showFailFun=function(a){$.PageDialog('<div class="mAltFail"><s></s>'+a+"</div>",{W:150,H:60,close:false,autoClose:true,submit:function(){location.reload()}})};var showOverLimitFun=function(){$.PageDialog('<div class="mAltFail"><s></s>您参与人次已达上限！</div>',{W:180,H:60,close:false,autoClose:true,submit:function(){}})};$.fn.GoodsBuyFun=function(b,a){var c=$(this);c.children("a").eq(0).click(function(){_IsLimitBuy=parseInt($(this).parent().attr("limitBuy"))>0;var e=function(k,j,h){_UserBalance=k;_LimitBuyNum=parseInt(j);_BuyedNum=parseInt(h);_GotoPayPage=false;var m=parseInt(c.prev("li.g-progress").find("span.blue em").html());if(m>0){var i='<div class="g-popup"><div class="g-buy-frame"><div id="buyBox" class="m-popup-buy"><p class="u-popup-remaining gray9">剩余 '+m+' 人次</p><div id="divNumber" class="u-popup-number gray6"><label>云购</label><a href="javascript:void();" class="num_del num_ban" id="num_del">-</a><input id="i_num" type="text" value="1" maxlength="7" surplus="'+m+'" class="num_dig"><a href="javascript:void();" class="num_add" id="num_add">+</a><label>人次</label></div><p class="u-popup-Tip grayb">'+getDefTip()+'</p><div class="u-popup-paytip" style="display:'+(_UserBalance>0?"none":"")+'"><p class="u-popup-paymoney gray3">总需支付<span class="orange FB">1.00</span>元</p><p class="u-popup-payRecharge gray6">您的帐户余额不足，<a href="http://member.1yyg.com/UserRecharge.do" target="_blank" class="blue">立即充值 <span>&gt;&gt;</span></a></p></div><p class="u-popup-balance gray9">您的帐户余额： <span class="gray6">'+k+'.00</span><span class="mlr5">元</span></p><div class="arrow_boxj" style="display:none;"><div class="arrow_box"><span class="arrow_dq"></span>确认支付后将直接从您的账户中扣除！</div></div><div class="m-popup_buybtn"><a id="btnConfirmBuy" href="javascript:void();" class="orange_btn">'+(_UserBalance>0?'确认支付<span class="mlr5">1.00</span>元':"使用其它方式支付")+"</a></div></div></div></div>";var l=240;if(_UserBalance<1){_GotoPayPage=true;l=300}$.PageDialog(i,{W:435,H:l,BShow:false,ready:function(){$("#divNumber").GoodsCountFun(a)}})}else{showFailFun("商品已被抢光了！")}};var f=function(i){var h=function(){var j=new popLogin();PagePOPLoginOK=function(){j.hide();i()};j.show()};if(_IsLoadLoginJS){h()}else{Base.getScript("http://skin.1yyg.com/JS/popLogin.js?date=20140814",function(){_IsLoadLoginJS=true;h()})}};var d=function(){GetJPData("http://api.1yyg.com","checkLoginEx","",function(h){if(h.code==0){e(h.money,0,0)}else{if(h.code==10){f(d)}}})};var g=function(){GetJPData("http://api.1yyg.com","checkUserLimitBuy","codeID="+a,function(h){if(h.code==0){e(h.userMoney,h.codeLimitBuy,h.buyNum)}else{if(h.code==-5){showFailFun("商品已被抢光了！")}else{if(h.code==-6){showOverLimitFun()}else{if(h.code==-10){f(g)}}}}})};if(_IsLimitBuy){g()}else{d()}return false});$(this).children("a").eq(1).click(function(){var d=$(this);GetJPData("http://cart.1yyg.com","shopCartNew","codeID="+a+"&num=1",function(f){if(f.code==0){_IsCartChanged=true;e()}else{if(f.code==1){showFailFun("商品已被抢光了！")}else{if(f.code==3){showOverLimitFun()}else{showFailFun("商品添加失败！")}}}});var e=function(){var f=function(){showParabola(d,1,b,function(){_InsertIntoCart()})};if(_IsLoadPlJs){f()}else{Base.getScript("http://skin.1yyg.com/JS/Parabola.js?date=150129",function(){_IsLoadPlJs=true;f()})}};return false})};var getListPaging=function(g,f,j,k,b){var c=1,h=1,e=1;var a="";c=parseInt(g/f);if(g%f>0){c++}if(c<1){c=1}a+='<div class="g-pagination w1190">';if(g>0){h=1;while(h+k<c+1&&h+k<j+2){h+=k-2}e=h+k-1;if(e>c){e=c}if(j==1){a+='<span class="f-noClick"><a title="上一页" href="javascript:;"><i class="f-tran f-tran-prev">&lt;</i>上一页</a></span>'}else{a+='<span><a title="上一页" href="'+b(j-1)+'"><i class="f-tran f-tran-prev">&lt;</i>上一页</a></span>'}if(h>1){a+='<span><a href="'+b(1)+'">1</a></span><span>…</span>'}for(var d=h;d<=e;d++){if(d!=j){a+='<span><a href="'+b(d)+'">'+d+"</a></span>"}else{a+='<span class="current"><a>'+d+"</a></span>"}}if(e<c){a+='<span>…</span><span><a href="'+b(c)+'">'+c+"</a></span>"}if(j<c){a+='<span><a href="'+b(j+1)+'">下一页<i class="f-tran f-tran-next">&gt;</i></a></span>'}else{a+='<span class="f-noClick"><a>下一页<i class="f-tran f-tran-next">&gt;</i></a></span>'}}a+='<span class="f-mar-left">共<em>'+c+"</em>页，去第</span>";a+='<span><input type="text" value="'+j+'">页</span>';a+='<span class="f-mar-left"><a id="btnGotoPage" href="javascript:;" title="确定">确定</a></span>';a+="</div>";return a};