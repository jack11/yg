var CBLFun=null;$(document).ready(function(){var c="http://www.1yyg.com";var a="http://skin.1yyg.com";var b=function(){var t=$("#hidSearchKey").val();var x=parseInt($("#hidOrder").val());var q=0;var g=20;var j=40;var e=parseInt($("#hidPageIndex").val());var f=0;var l=1;var k=j/g;var n=0;var o=$("div.list_sort");var w=$("#ulGoodsList");var p=$("#divTopPageInfo");var v=$("#divPageNav");var i=$("#divLoadingLine");var r=true;var u=false;var s=false;var m=new Object();$("li[name='liPrice']").each(function(z,y){if(z==0){$(this).hover(function(){$(this).hide().next().show()},function(){})}else{$(this).hover(function(){},function(){$(this).hide().prev().show()})}});$.fn.grayImg=function(){var C=$(this).find("img");var A=document.createElement("canvas");var E=A.getContext("2d");C.attr("crossOrigin","");var G=C.width();var B=C.height();A.width=G;A.height=B;E.drawImage(C.get(0),0,0);var z=E.getImageData(0,0,G,B);for(var H=0;H<z.height;H++){for(var I=0;I<z.width;I++){var D=(H*4)*z.width+I*4;var F=(z.data[D]+z.data[D+1]+z.data[D+2])/3;z.data[D]=F;z.data[D+1]=F;z.data[D+2]=F}}E.putImageData(z,0,0,0,0,z.width,z.height);C.attr("src",A.toDataURL())};var d=function(){var y=(e-1)*j;return"key="+encodeURIComponent(t.replace(/(\/)/g,""))+"&orderFlag="+x+"&FIdx="+(y+1)+"&EIdx="+(y+j)+"&isCount="+l};var h=function(){var A=function(){i.show();GetJPData("http://api.1yyg.com","getSearchList",d(),function(C){if(C.code==0){var B=function(){if(l==1){n=C.count;f=n%j==0?n/j:parseInt(n/j)+1;l=0}var E='<p class="Fl">共<em class="orange">'+n+"</em>件商品<b>"+e+"</b>/"+f+'</p><div class="u-list-btn fl"><a href="'+(e==1?"javascript:;":z(e-1))+'" class="'+(e==1?"u-btn-gray":"")+'" title="上一页"><span class="f-tran f-tran-prev">&lt;</span>上一页</a><a href="'+(e==f?"javascript:;":z(e+1))+'" class="'+(f>1?(e==f?"u-btn-gray":""):"u-btn-gray")+'" title="下一页">下一页<span class="f-tran f-tran-next">&gt;</span></a></div>';p.html(E);i.hide();var D=C.listItems;var F=D.length;if(F>0){m["page"+e]=D;y()}else{q=k}};if(u){B()}else{Base.getScript(a+"/JS/GoodsComm.js?date=150305",function(){u=true;B()})}}else{i.hide();if(q==0){if(t!=""){w.hide().after('<div class="g-noConMsg"><span>未找到有关“<em class="orange">'+t+"</em>”的商品</span></div>")}else{w.hide().after('<div class="g-noConMsg"><span>请输入您想搜索的关键词！</span></div>')}}else{if(e!=1&&n>j){v.html(getListPaging(n,j,e,5,z)).show()}}q=k}r=false})};var y=function(){q++;var F=m["page"+e];if(F!=null&&F!=undefined){var L=F.length;var B=(q-1)*g;var N=B+g;N=N>L?L:N;var K="";var I="";var C=0;var G=0;var D=0;var M=0;var T=0;var P=$(window).width()<1190?217:266;w.show();for(var S=B;S<N;S++){K="";I=F[S].goodsSName;var R=F[S].isSale==1;if(R){I="(第"+F[S].codePeriod+"期)&nbsp;"+I;var E="";var O=parseInt(F[S].goodsTag);switch(O){case 1:E+='<div class="f-callout"><span class="F_goods_xp transparent-png">新品</span></div>';break;case 2:E+='<div class="f-callout"><span class="F_goods_tj transparent-png">推荐</span></div>';break;case 3:E+='<div class="f-callout"><span class="F_goods_rq transparent-png">人气</span></div>';break;case 10:E+='<div class="f-callout"><span class="F_goods_xg transparent-png">限购</span></div>';break}C=parseInt(F[S].codeSales);G=parseInt(F[S].codeQuantity);D=parseInt(G-C);M=parseFloat(C)/G;T=parseInt(M*P);K+="<div idx="+(S+1)+' class="soon-list-con '+((S+1)%4==0?"soon-list4":"")+'" codeID="'+F[S].codeID+'" limitBuy="'+F[S].codeLimitBuy+'"><div class="soon-list"><ul><li class="g-soon-pic"><a href="/products/'+F[S].goodsID+'.html" target="_blank" title="'+I+'"><img name="goodsImg" src="http://goodsimg.1yyg.com/GoodsPic/pic-200-200/'+F[S].goodsPic+'" /></a></li><li class="soon-list-name"><a href="/products/'+F[S].goodsID+'.html" target="_blank" title="'+I+'">'+I+'</a></li><li class="gray6">价值：￥'+formatFloat(F[S].codePrice)+'</li><li class="g-progress"><dl class="m-progress"><dt title="已完成'+formatFloat(M*100)+'%"><b style="width:'+(C==0?0:(parseInt(T)==0?1:T))+'px;"></b></dt><dd><span class="orange fl"><em>'+C+'</em>已参与</span><span class="gray6 fl"><em>'+G+'</em>总需人次</span><span class="blue fr"><em>'+D+'</em>剩余</span></dd></dl></li><li name="buyBox"><a href="javascript:;" title="立即1元云购" class="u-now">立即1元云购</a><a href="javascript:;" class="u-cart"><s></s></a></li></ul>'+E+'</div><div class="u_buyCount"></div></div>'}else{K+="<div idx="+(S+1)+' class="soon-list-con '+((S+1)%4==0?"soon-list4":"")+'"><div class="soon-list m-list-shelves"><dl><dt><a href="/products/'+F[S].goodsID+'.html" target="_blank" title="'+I+'"><img src="http://goodsimg.1yyg.com/GoodsPic/pic-200-200/'+F[S].goodsPic+'" /></a></dt><dd><p><a href="/products/'+F[S].goodsID+'.html" target="_blank" title="'+I+'">'+I+"</a></p>价值：￥"+formatFloat(F[S].codePrice)+'</dd><dd class="f-shelves-btn"><a href="/products/'+F[S].goodsID+'.html" target="_blank" title="查看详情">查看详情</a></dd></dl><div class="f-shelves-yxj"><span>已结束</span></div></div></div>'}var J=$(K);if((S+1)==L&&L%4!=0){J.addClass("f-add-borR")}w.append(J).show();if(R){J.GoodsItemFun()}else{J.hover(function(){if(parseInt($(this).attr("idx"))%4==0){$(this).removeClass("soon-list4").addClass("soon-list-hover2")}$(this).addClass("soon-list-hover")},function(){if(parseInt($(this).attr("idx"))%4==0){$(this).addClass("soon-list4").removeClass("soon-list-hover2")}$(this).removeClass("soon-list-hover")})}}if(L<g||q*g==n){q=k}if(q>=k){if(n>j){v.html(getListPaging(n,j,e,5,z)).parent().show();if(!s){s=true;var U=$("#btnGotoPage");var H=U.parent().prev().find("input");var V=function(){var W=parseInt(H.val());if(W>0){if(W>f){W=f}window.location.href=z(W)}return false};var Q=1;H.keyup(function(X){var Y=X||window.event||arguments.callee.caller.arguments[0];if(Y){if(Y.keyCode==13){V()}else{var W=$(this).val();if(!(/^\d+$/.test(W))){$(this).val(Q)}else{Q=W;$(this).val(W)}}}}).mouseover(function(){$(this).focus().select()});U.click(function(){V();return false})}}else{v.hide()}}w.show()}i.hide()};var z=function(B){var C="/search/";C+="m"+B+"/";if(x>10){C+="r"+x+"/"}C+="?q="+t;return C};this.nextList=function(){y()};this.initPage=function(){A()}};$(window).scroll(function(){if(q<k&&!r){var y=$(window).scrollTop()+$(window).height();var z=w.offset().top+w.height();if(y>=z){if(r){return}if(w.children().length==0){return}r=true;CBLFun.nextList()}}});CBLFun=new h();CBLFun.initPage();$("#txtHSearch").css({color:"#333",padding:"9px 0px 9px 5px",width:"268px"}).val(t).next("span").css("zIndex","0").hide()};b()});